<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Sea horse Game</title>
<style>
  html, body {
    margin: 0;
    height: 100%;
    overflow: hidden;
  }

  #game, #c {
    position: fixed;
    top: 0;
    left: 0;
  }

  #c {
    display: none;
    touch-action: none;
    pointer-events: none;
  }
</style>
</head>
<body>

<canvas id="game"></canvas>
<canvas id="c"></canvas>

<script>
// ===== Background Music =====
const bgMusic = new Audio();
bgMusic.src = "music-for-games-153673.mp3";  // Relative path - same folder
bgMusic.loop = true;
bgMusic.volume = 1.0;  // 100% volume

// Automatically start music after 4 seconds
setTimeout(() => {
  bgMusic.play().catch(e => {
    console.log("Audio play failed:", e);
  });
}, 4000);

// ===== Background Canvas =====
const bg = new Image();
bg.src = "https://i.ibb.co/B2d7phhQ/1765805601854-2.jpg";

const gameCanvas = document.getElementById("game");
const gameCtx = gameCanvas.getContext("2d");

function resizeGameCanvas() {
    gameCanvas.width = window.innerWidth;
    gameCanvas.height = window.innerHeight;
    drawBackground();
}

function drawBackground() {
    gameCtx.drawImage(bg, 0, 0, gameCanvas.width, gameCanvas.height);
}

bg.onload = () => {
    resizeGameCanvas();
};

window.addEventListener("resize", () => {
    resizeGameCanvas();
});

// ===== Joystick Canvas =====
const canvas = document.getElementById("c");
const ctx = canvas.getContext("2d");

const OUTER_RADIUS = 70;
const RING_THICKNESS = 10;
const KNOB_RADIUS = 20;
const KNOB_STROKE = 5;

function setJoystickSize(){
  const size = (OUTER_RADIUS + RING_THICKNESS + 10) * 2;
  canvas.width = size;
  canvas.height = size;
}
setJoystickSize();

const center = { x: 0, y: 0 };
const state = {
  knobPos: { x: 0, y: 0 },
  dragging: false,
  active: false
};

function drawJoystick(){
  ctx.clearRect(0,0,canvas.width,canvas.height);

  const cx = center.x, cy = center.y;
  const knobX = cx + state.knobPos.x;
  const knobY = cy + state.knobPos.y;

  // Outer ring
  ctx.beginPath();
  ctx.lineWidth = RING_THICKNESS;
  ctx.strokeStyle = "#000";
  ctx.arc(cx, cy, OUTER_RADIUS, 0, Math.PI*2);
  ctx.stroke();

  // Knob outline
  ctx.beginPath();
  ctx.lineWidth = KNOB_STROKE;
  ctx.strokeStyle = "#000";
  ctx.arc(knobX, knobY, KNOB_RADIUS, 0, Math.PI*2);
  ctx.stroke();

  // Knob fill
  ctx.beginPath();
  ctx.fillStyle = "#fff";
  ctx.arc(knobX, knobY, KNOB_RADIUS - KNOB_STROKE/2, 0, Math.PI*2);
  ctx.fill();
}

function clientToCanvas(ev){
  const rect = canvas.getBoundingClientRect();
  let x, y;
  if(ev.touches){
    x = ev.touches[0].clientX;
    y = ev.touches[0].clientY;
  } else {
    x = ev.clientX;
    y = ev.clientY;
  }
  return {
    x: (x - rect.left) * (canvas.width / rect.width),
    y: (y - rect.top) * (canvas.height / rect.height)
  };
}

function pointerDown(ev){
  ev.preventDefault();
  
  const touchX = ev.touches ? ev.touches[0].clientX : ev.clientX;
  const touchY = ev.touches ? ev.touches[0].clientY : ev.clientY;

  const size = canvas.width;
  canvas.style.left = (touchX - size/2) + "px";
  canvas.style.top  = (touchY - size/2) + "px";

  canvas.style.display = "block";
  state.dragging = true;
  state.active = true;
  center.x = canvas.width / 2;
  center.y = canvas.height / 2;
  drawJoystick();
}

function pointerMove(ev){
  if(!state.dragging) return;
  ev.preventDefault();
  const pos = clientToCanvas(ev);
  let nx = pos.x - center.x;
  let ny = pos.y - center.y;

  const max = OUTER_RADIUS - KNOB_RADIUS - (RING_THICKNESS/2);
  const mag = Math.hypot(nx, ny);
  if(mag > max){
    nx = nx / mag * max;
    ny = ny / mag * max;
  }

  state.knobPos.x = nx;
  state.knobPos.y = ny;
  drawJoystick();
}

function pointerUp(){
  state.dragging = false;
  state.knobPos.x = 0;
  state.knobPos.y = 0;
  drawJoystick();
  canvas.style.display = "none";
}

// Event listeners (joystick still works on touch/mouse)
window.addEventListener("touchstart", pointerDown, { passive: false });
window.addEventListener("touchmove", pointerMove, { passive: false });
window.addEventListener("touchend", pointerUp);

window.addEventListener("mousedown", pointerDown);
window.addEventListener("mousemove", pointerMove);
window.addEventListener("mouseup", pointerUp);
</script>

</body>
</html>
