import React, { useState, useRef, useEffect } from 'react';
import { Pause, RotateCcw, Settings, Gamepad2, ThumbsUp, Play } from 'lucide-react';

export default function GameUI() {
  const [isPaused, setIsPaused] = useState(false);
  const audioContextRef = useRef(null);
  const musicIntervalRef = useRef(null);

  const playKick = (audioContext) => {
    const now = audioContext.currentTime;
    const kick = audioContext.createOscillator();
    const kickGain = audioContext.createGain();
    kick.connect(kickGain);
    kickGain.connect(audioContext.destination);
    kick.frequency.setValueAtTime(150, now);
    kick.frequency.exponentialRampToValueAtTime(40, now + 0.5);
    kickGain.gain.setValueAtTime(0.5, now);
    kickGain.gain.exponentialRampToValueAtTime(0.01, now + 0.5);
    kick.start(now);
    kick.stop(now + 0.5);
  };

  const playHiHat = (audioContext) => {
    const now = audioContext.currentTime;
    const hihat = audioContext.createOscillator();
    const hihatGain = audioContext.createGain();
    hihat.type = 'square';
    hihat.frequency.value = 10000;
    hihat.connect(hihatGain);
    hihatGain.connect(audioContext.destination);
    hihatGain.gain.setValueAtTime(0.1, now);
    hihatGain.gain.exponentialRampToValueAtTime(0.01, now + 0.05);
    hihat.start(now);
    hihat.stop(now + 0.05);
  };

  const playSnare = (audioContext) => {
    const now = audioContext.currentTime;
    const snare = audioContext.createOscillator();
    const snareGain = audioContext.createGain();
    snare.type = 'triangle';
    snare.frequency.value = 200;
    snare.connect(snareGain);
    snareGain.connect(audioContext.destination);
    snareGain.gain.setValueAtTime(0.3, now);
    snareGain.gain.exponentialRampToValueAtTime(0.01, now + 0.2);
    snare.start(now);
    snare.stop(now + 0.2);
  };

  useEffect(() => {
    const initAudio = async () => {
      try {
        if (!audioContextRef.current) {
          audioContextRef.current = new (window.AudioContext || window.webkitAudioContext)();
        }
        
        const audioContext = audioContextRef.current;
        
        if (audioContext.state === 'suspended') {
          await audioContext.resume();
        }

        if (musicIntervalRef.current) {
          clearInterval(musicIntervalRef.current);
        }

        const bpm = 90;
        const beatDuration = (60 / bpm) * 1000;
        
        let beatCount = 0;
        
        musicIntervalRef.current = setInterval(() => {
          if (beatCount % 4 === 0 || beatCount % 4 === 2) {
            playKick(audioContext);
          }
          
          if (beatCount % 4 === 1 || beatCount % 4 === 3) {
            playSnare(audioContext);
          }
          
          playHiHat(audioContext);
          
          beatCount++;
        }, beatDuration / 2);
      } catch (error) {
        console.error('Error starting music:', error);
      }
    };
    
    document.addEventListener('click', initAudio, { once: true });
    
    return () => {
      document.removeEventListener('click', initAudio);
      if (musicIntervalRef.current) {
        clearInterval(musicIntervalRef.current);
      }
    };
  }, []);

  const playClickSound = async () => {
    try {
      if (!audioContextRef.current) {
        audioContextRef.current = new (window.AudioContext || window.webkitAudioContext)();
      }
      
      const audioContext = audioContextRef.current;
      
      if (audioContext.state === 'suspended') {
        await audioContext.resume();
      }
      
      const oscillator = audioContext.createOscillator();
      const gainNode = audioContext.createGain();
      
      oscillator.connect(gainNode);
      gainNode.connect(audioContext.destination);
      
      const now = audioContext.currentTime;
      
      oscillator.frequency.setValueAtTime(1200, now);
      oscillator.frequency.exponentialRampToValueAtTime(100, now + 0.05);
      
      oscillator.type = 'sine';
      
      gainNode.gain.setValueAtTime(0.3, now);
      gainNode.gain.exponentialRampToValueAtTime(0.01, now + 0.05);
      
      oscillator.start(now);
      oscillator.stop(now + 0.05);
    } catch (error) {
      console.error('Error playing click sound:', error);
    }
  };

  const handleButtonClick = (buttonName) => {
    console.log(`${buttonName} clicked`);
    
    playClickSound();
    
    if (buttonName === 'Pause') {
      setIsPaused(!isPaused);
    }
  };

  return (
    <div className="min-h-screen bg-gradient-to-br from-cyan-500 to-blue-600 flex items-center justify-center p-8">
      <div className="relative w-full max-w-xl">
        {/* Title */}
        <div className="text-center mb-6">
          <h1 className="text-4xl sm:text-5xl md:text-6xl font-black text-white tracking-wider" style={{
            textShadow: '0 0 15px rgba(255,165,0,0.5), 3px 3px 0 #ff8c00, 6px 6px 0 rgba(0,0,0,0.2)',
            WebkitTextStroke: '2px #ff8c00'
          }}>
            Game UI
          </h1>
        </div>

        {/* Button Container */}
        <div className="flex items-center justify-center">
          <div className="relative w-72 h-72 sm:w-80 sm:h-80">
            {/* Pause Button - Top Left */}
            <button
              onClick={() => handleButtonClick('Pause')}
              className="absolute top-0 left-0 w-16 h-16 sm:w-20 sm:h-20 rounded-full bg-gradient-to-br from-orange-400 to-orange-600 shadow-lg hover:shadow-xl transform hover:scale-105 transition-all flex items-center justify-center border-3 border-white"
              style={{ boxShadow: '0 6px 0 rgba(0,0,0,0.3), 0 0 15px rgba(255,165,0,0.4)' }}
            >
              <Pause className="w-8 h-8 sm:w-10 sm:h-10 text-white" fill="white" />
            </button>

            {/* Restart Button - Top Right */}
            <button
              onClick={() => handleButtonClick('Restart')}
              className="absolute top-0 right-0 w-16 h-16 sm:w-20 sm:h-20 rounded-full bg-gradient-to-br from-red-500 to-red-700 shadow-lg hover:shadow-xl transform hover:scale-105 transition-all flex items-center justify-center border-3 border-white"
              style={{ boxShadow: '0 6px 0 rgba(0,0,0,0.3), 0 0 15px rgba(220,38,38,0.4)' }}
            >
              <RotateCcw className="w-7 h-7 sm:w-9 sm:h-9 text-white" strokeWidth={3} />
            </button>

            {/* Play Button - Center */}
            <button
              onClick={() => handleButtonClick('Play')}
              className="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-24 h-24 sm:w-28 sm:h-28 rounded-full bg-gradient-to-br from-pink-400 to-pink-600 shadow-lg hover:shadow-xl transform hover:scale-105 transition-all flex items-center justify-center border-3 border-white"
              style={{ boxShadow: '0 8px 0 rgba(0,0,0,0.3), 0 0 20px rgba(236,72,153,0.4)' }}
            >
              <Play className="w-12 h-12 sm:w-14 sm:h-14 text-white ml-1" fill="white" />
            </button>

            {/* Settings Button - Bottom Left */}
            <button
              onClick={() => handleButtonClick('Settings')}
              className="absolute bottom-0 left-0 w-16 h-16 sm:w-20 sm:h-20 rounded-full bg-gradient-to-br from-yellow-300 to-yellow-500 shadow-lg hover:shadow-xl transform hover:scale-105 transition-all flex items-center justify-center border-3 border-white"
              style={{ boxShadow: '0 6px 0 rgba(0,0,0,0.3), 0 0 15px rgba(234,179,8,0.4)' }}
            >
              <Settings className="w-8 h-8 sm:w-10 sm:h-10 text-white" strokeWidth={2.5} />
            </button>

            {/* Like Button - Bottom Center */}
            <button
              onClick={() => handleButtonClick('Like')}
              className="absolute bottom-0 left-1/2 -translate-x-1/2 w-16 h-16 sm:w-20 sm:h-20 rounded-full bg-gradient-to-br from-green-400 to-green-600 shadow-lg hover:shadow-xl transform hover:scale-105 transition-all flex items-center justify-center border-3 border-white"
              style={{ boxShadow: '0 6px 0 rgba(0,0,0,0.3), 0 0 15px rgba(34,197,94,0.4)' }}
            >
              <ThumbsUp className="w-8 h-8 sm:w-10 sm:h-10 text-white" fill="white" />
            </button>

            {/* Controller Button - Bottom Right */}
            <button
              onClick={() => handleButtonClick('Controller')}
              className="absolute bottom-0 right-0 w-16 h-16 sm:w-20 sm:h-20 rounded-full bg-gradient-to-br from-cyan-400 to-cyan-600 shadow-lg hover:shadow-xl transform hover:scale-105 transition-all flex items-center justify-center border-3 border-white"
              style={{ boxShadow: '0 6px 0 rgba(0,0,0,0.3), 0 0 15px rgba(34,211,238,0.4)' }}
            >
              <Gamepad2 className="w-8 h-8 sm:w-10 sm:h-10 text-white" strokeWidth={2} />
            </button>
          </div>
        </div>
      </div>
    </div>
  );
}
